<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Astrohelion: Developer Notes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Astrohelion
   </div>
   <div id="projectbrief">An open source multi-body astrodynamics toolkit for C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Developer Notes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Information that will be useful for developers</p>
<h2>Tested Platforms</h2>
<p>This software has been tested on (and <em>should</em> work on) the following system platforms and architectures: </p><ul>
<li>
Debian Linux Ubuntu/Mint 14.04 - AMD 64-bit  </li>
<li>
Mac OS X 10.10.3 - Intel 64-bit </li>
</ul>
<h2>Software Dependencies</h2>
<p>This software is dependent on several libraries. My goal is to package these libraries with Astrohelion, but that task is not yet complete. Stay tuned. In the mean time, here is a list of dependencies with some (hopefully helpful) installation tips: </p>
<ul>
<li>
<a href="http://www.gnu.org/software/gsl/">GNU Science Library</a> (GSL): This library should be installed on your system and available to the compiler. The Makefile assumes all GSL headers and libraries are already in the search path. To compile with the GSL libraries, use the <code>-lgsl</code> and <code>-lgslcblas</code> compiler flags  </li>
<li>
<a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a>: A matrix and linear algebra library. No installation is needed; this header-only library is included with the source code.  </li>
<li>
<a href="http://sourceforge.net/projects/matio/">Mat I/O Library</a>: This library provides functions to convert from data types in C/C++ to MATLAB binary *.mat files. For testing, the library has been configured, built, and installed without specifying any non-default flags. This prevents the library from outputing version 7.3 format Mat files, but older versions work fine. Note that this library has its own dependencies; see their documentation for more details, but note that we didn't have to install anything extra; all dependencies were already included on our system. <ul>
<li>
Note on linux: Had to add <code>/usr/local/lib</code> to LD_LIBRARY_PATH and export in .bashrc  </li>
</ul>
</li>
<li>
<a href="http://www.boost.org/">Boost</a>: A library with many useful functions, including file operations and XML file operations. To install: <ol>
<li>
Download the latest version of Boost </li>
<li>
Navigate into the main directory and run <pre>sudo ./bootstrap.sh</pre> to initialize the system </li>
<li>
Next, we need to compile a few libraries and install all the headers. On MacOS, I'm using g++-6 to compile the software. I'm avoiding clang++ because it doesn't support openMP. To tell the Boost builder to use the compiler I want, I specify an additional flag, <code>toolset=gcc-6</code>. Astrohelion only needs a few Boost libraries, and they are specified with an additional flag. The full install command is <pre>sudo ./b2 toolset=gcc-6 install --with-fileystem --with-system --with-test</pre>  </li>
</ol>
Following these steps installs boost in the default location (<code>/usr/local/</code> for me). If you want to specifiy a different install directory, you'll have to add the <code>&ndash;prefix</code> tag and update the makefiles to locate the headers and libraries. Other useful build instructions are listed <a href="http://www.boost.org/doc/libs/1_60_0/more/getting_started/unix-variants.html#prepare-to-use-a-boost-library-binary">here</a>. On Linux, you'll need to specify a custom LD path, <code>LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib/</code>.  </li>
<li>
<a href="http://naif.jpl.nasa.gov/naif/toolkit_C.html">NAIF SPICE</a>: This library provides access to accurate ephemerides. To install, I downloaded the 64-bit tar.Z file for OS X and ran the installation script. Spice doesn't install itself like other libraries do, so I took the necessary steps to install it the usual way: <ol>
<li>
Copy the header files from <code>include/</code> to <code>/usr/local/include/cspice</code>  </li>
<li>
Rename the library files to begin with "lib" so that C/C++ will link them appropriately. I then copied them to the <code>/usr/local/lib/</code> directory.  </li>
<li>
Copy the executable binaries from the <code>exe/</code> directory into <code>/usr/local/bin/cspice/</code> and add a line to the <code>.bash_profile</code> configuration file: <code>PATH=$PATH:/usr/local/bin/cspice/</code> so that I can access these binary files from the command line.  </li>
</ol>
To use SPICE functions, include the <code>SpiceUsr.h</code> header file, which is a sort of include-wrapper that includes all the relevant headers for SPICE routines. An API for the C toolkit can be found <a href="http://naif.jpl.nasa.gov/pub/naif/toolkit_docs/C/index.html">here</a>  </li>
</ul>
<h2>Debugging</h2>
<h3>In General</h3>
<p>First, open X11 from the Applications menu. Then, run the executable using the graphic debugging library: </p><pre>
    ddd -display :0.0 simEngineTest
</pre><p> For this to work, you must compile the executable with the debugging symbols; use the <code>-g</code> flag in the compiler. Alternatively, skip the GUI and run <code>gdb</code> from the terminal directly. Common commands include </p><pre>
    gdb --args runAScript arg1 arg2     // Allows user to specify input arguments
    gdb runAScript                      // no input arguments
</pre><h3>Checking Linked (Dynamically) Libraries</h3>
<p>Run </p><pre>
    oTool -L path/to/bin
</pre><p> to retrieve a list of all the dynamic libraries linked to the executable binary, as well as the locations of those libraries. Note that static libraries are not included in this listing.</p>
<h3>Checking for Dependency Issues</h3>
<p>Run doxygen with the inheritance/dependency plots turned on (this is already set for this project).</p>
<h3>Checking for Memory Leaks</h3>
<p>Use valgrind to check for leaks: </p><pre>
    valgrind --tool=memcheck --leak-check=yes simEngineTest
</pre><p> On my Macbook, I've created a file at <code>~/.valgrindrc</code> which specifies arguments for valgrind so I don't have to type out the lengthy code above, I just type <code>valgrind simEngineTest</code>. I've also created a file called <code>valgrindIgnore.supp</code> with code to tell valgrind to suppress memory leaks that come from system libraries that I have no control over.</p>
<h2>Coding Practice Notes</h2>
<h3>Do's and Dont's</h3>
<ul>
<li>
<b>Do</b> check that an index is valid before accessing via square brackets </li>
</ul>
<h2>Code Style Choices</h2>
<h3>Naming conventions</h3>
<ul>
<li>
Classes begin with a capital letter and follow camel-case </li>
<li>
Dynamical system acronyms are all lowercase, i.e., cr3bp, not CR3BP </li>
<li>
Enumerated types that specify a <code>type</code> end with _tp </li>
<li>
In general, variables begin with lower case letters </li>
<li>
Boolean variables begin with b, i.e., <code>bIsCounting</code> </li>
<li>
Pointer variables begin with p, i.e., <code>pTrajectory</code> </li>
<li>
Static const variables are all uppercase, i.e., PI </li>
</ul>
<h3>"Right Way" to include</h3>
<p>Say I'm writing class A and want to know whether or not to include or forward-declare class B: </p><ul>
<li>
do nothing if: A makes no references at all to B  </li>
<li>
do nothing if: The only reference to B is in a friend declaration  </li>
<li>
forward declare B if: A contains a B pointer or reference: B* myb;  </li>
<li>
forward declare B if: one or more functions has a B object/pointer/reference as a parementer, or as a return type: B MyFunction(B myb);  </li>
<li>
<code>#include "b.h"</code> if: B is a parent class of A  </li>
<li>
<code>#include "b.h"</code> if: A contains a B object: B myb;  </li>
</ul>
<p>Include Order (my convention:) </p><ol>
<li>
Header file for this class  </li>
<li>
Local header files - ones I've written, in alphabetical order  </li>
<li>
Global header files, like string, vector, etc.  </li>
</ol>
<h2>Optimizing Code</h2>
<ul>
<li>
Check out <a href="http://stackoverflow.com/questions/11445619/profiling-c-on-mac-os-x">these</a> instructions for profiling code on OS X </li>
<li>
Creating copies of objects can be <em>very</em> expensive! Use pointers to objects whenever possible and practical! </li>
</ul>
<h2>MatIO Read/Write</h2>
<p>When saving and reading unsigned integers, use <code>MAT_T_UINT32</code> and <code>MAT_C_UINT32</code>. When the 8 and 16 bit versions are used the data is saved with strange trailing zeros, e.g., "1 0 0 0" and "1 0", respectively, in place of a single "1" value. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
